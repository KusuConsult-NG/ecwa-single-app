"use strict";(()=>{var e={};e.id=130,e.ids=[130],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6858:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>c,routeModule:()=>h,serverHooks:()=>p,staticGenerationAsyncStorage:()=>g});var a={};i.r(a),i.d(a,{GET:()=>l,POST:()=>o});var s=i(9303),n=i(8716),r=i(670),d=i(7070),u=i(8990);async function l(e){try{let e=await u.db.getFinancials();return d.NextResponse.json({financials:e})}catch(e){return console.error("Error fetching financials:",e),d.NextResponse.json({error:"Failed to fetch financials"},{status:500})}}async function o(e){try{let{type:t,amount:i,description:a,category:s,date:n}=await e.json(),r=await u.db.createFinancial({type:t,amount:i,description:a,category:s,date:n||new Date().toISOString()});return d.NextResponse.json({success:!0,financial:r,message:"Financial record created successfully"})}catch(e){return console.error("Error creating financial record:",e),d.NextResponse.json({error:"Failed to create financial record"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/financials/route",pathname:"/api/financials",filename:"route",bundlePath:"app/api/financials/route"},resolvedPagePath:"/Users/mac/ecwa-single-app/src/app/api/financials/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:g,serverHooks:p}=h,f="/api/financials/route";function w(){return(0,r.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:g})}},5456:(e,t,i)=>{i.d(t,{Gv:()=>u,c_:()=>d,fT:()=>r});var a=i(2986);let s=process.env.AUTH_SECRET||"ecwa-multitenant-secret-key",n=new TextEncoder().encode(s);async function r(e){return await new a.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(n)}function d(e){return Buffer.from(e+"ecwa-salt").toString("base64")}function u(e,t){return d(e)===t}},8990:(e,t,i)=>{i.d(t,{db:()=>n});var a=i(5456);class s{async initializeSampleData(){if(this.initialized)return;this.initialized=!0;let e=await this.createUser({email:"admin@ecwa.app",name:"Admin User",role:"Admin",permissions:["*"]});await this.updateUser(e.id,{passwordHash:(0,a.c_)("admin123")});let t=await this.createUser({email:"treasurer@ecwa.app",name:"Treasurer User",role:"Treasurer",permissions:["financials.read","financials.write","expenditures.read","expenditures.write"]});await this.updateUser(t.id,{passwordHash:(0,a.c_)("treasurer123")}),this.financials.set(this.defaultOrgId,[{id:"fin_1",type:"income",amount:5e4,description:"Tithe Collection",date:new Date().toISOString(),category:"Tithe"}]),this.members.set(this.defaultOrgId,[{id:"mem_1",name:"John Doe",email:"john@example.com",phone:"+2348012345678",address:"123 Main St, Jos",membershipDate:new Date().toISOString(),status:"active"}]),this.leaders.set(this.defaultOrgId,[{id:"leader_1",name:"Pastor John Smith",email:"pastor@ecwa.app",phone:"+2348012345678",role:"Senior Minister",portfolio:"Pastoral Care",status:"active",startDate:new Date().toISOString(),createdAt:new Date().toISOString()},{id:"leader_2",name:"Mrs. Sarah Johnson",email:"accountant@ecwa.app",phone:"+2348012345679",role:"Accountant",portfolio:"Financial Management",status:"active",startDate:new Date().toISOString(),createdAt:new Date().toISOString()},{id:"leader_3",name:"Mr. David Wilson",email:"auditor@ecwa.app",phone:"+2348012345680",role:"Auditor",portfolio:"Financial Oversight",status:"active",startDate:new Date().toISOString(),createdAt:new Date().toISOString()}])}async ensureInitialized(){this.initialized||await this.initializeSampleData()}async createUser(e){await this.ensureInitialized();let t={...e,id:`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()};return this.users.push(t),t}async getUserByEmail(e){return await this.ensureInitialized(),this.users.find(t=>t.email===e)||null}async getUserById(e){return await this.ensureInitialized(),this.users.find(t=>t.id===e)||null}async updateUser(e,t){await this.ensureInitialized();let i=this.users.findIndex(t=>t.id===e);return -1!==i?(this.users[i]={...this.users[i],...t},this.users[i]):null}async createSession(e){await this.ensureInitialized();let t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.sessions.set(t,{userId:e,expires:new Date(Date.now()+864e5)}),t}async getSession(e){await this.ensureInitialized();let t=this.sessions.get(e);return t&&t.expires>new Date?await this.getUserById(t.userId):null}async deleteSession(e){await this.ensureInitialized(),this.sessions.delete(e)}async getFinancials(){return await this.ensureInitialized(),this.financials.get(this.defaultOrgId)||[]}async createFinancial(e){await this.ensureInitialized();let t={...e,id:`fin_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()},i=this.financials.get(this.defaultOrgId)||[];return i.push(t),this.financials.set(this.defaultOrgId,i),t}async getMembers(){return await this.ensureInitialized(),this.members.get(this.defaultOrgId)||[]}async createMember(e){await this.ensureInitialized();let t={...e,id:`mem_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()},i=this.members.get(this.defaultOrgId)||[];return i.push(t),this.members.set(this.defaultOrgId,i),t}async getExpenditures(){return await this.ensureInitialized(),this.expenditures.get(this.defaultOrgId)||[]}async createExpenditure(e){await this.ensureInitialized();let t={...e,id:`exp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()},i=this.expenditures.get(this.defaultOrgId)||[];return i.push(t),this.expenditures.set(this.defaultOrgId,i),t}async getAgencies(){return await this.ensureInitialized(),this.agencies.get(this.defaultOrgId)||[]}async createAgency(e){await this.ensureInitialized();let t={...e,id:`agency_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()},i=this.agencies.get(this.defaultOrgId)||[];return i.push(t),this.agencies.set(this.defaultOrgId,i),t}async getStaff(){return await this.ensureInitialized(),this.staff.get(this.defaultOrgId)||[]}async createStaff(e){await this.ensureInitialized();let t={...e,id:`staff_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()},i=this.staff.get(this.defaultOrgId)||[];return i.push(t),this.staff.set(this.defaultOrgId,i),t}async getRequisitions(){return await this.ensureInitialized(),this.requisitions.get(this.defaultOrgId)||[]}async createRequisition(e){await this.ensureInitialized();let t={...e,id:`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()},i=this.requisitions.get(this.defaultOrgId)||[];return i.push(t),this.requisitions.set(this.defaultOrgId,i),t}async getRequisition(e){return await this.ensureInitialized(),(this.requisitions.get(this.defaultOrgId)||[]).find(t=>t.id===e)||null}async updateRequisition(e,t){await this.ensureInitialized();let i=this.requisitions.get(this.defaultOrgId)||[],a=i.findIndex(t=>t.id===e);return -1!==a?(i[a]={...i[a],...t},this.requisitions.set(this.defaultOrgId,i),i[a]):null}async getLeaders(){return await this.ensureInitialized(),this.leaders.get(this.defaultOrgId)||[]}async createLeader(e){await this.ensureInitialized();let t={...e,id:`leader_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()},i=this.leaders.get(this.defaultOrgId)||[];return i.push(t),this.leaders.set(this.defaultOrgId,i),t}async getLeader(e){return await this.ensureInitialized(),(this.leaders.get(this.defaultOrgId)||[]).find(t=>t.id===e)||null}async updateLeader(e,t){await this.ensureInitialized();let i=this.leaders.get(this.defaultOrgId)||[],a=i.findIndex(t=>t.id===e);return -1!==a?(i[a]={...i[a],...t},this.leaders.set(this.defaultOrgId,i),i[a]):null}async deleteLeader(e){await this.ensureInitialized();let t=this.leaders.get(this.defaultOrgId)||[],i=t.findIndex(t=>t.id===e);return -1!==i&&(t.splice(i,1),this.leaders.set(this.defaultOrgId,t),!0)}constructor(){this.users=[],this.sessions=new Map,this.financials=new Map,this.members=new Map,this.expenditures=new Map,this.agencies=new Map,this.staff=new Map,this.requisitions=new Map,this.leaders=new Map,this.initialized=!1,this.defaultOrgId="ecwa-main"}}let n=new s}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[8948,5972,2986],()=>i(6858));module.exports=a})();